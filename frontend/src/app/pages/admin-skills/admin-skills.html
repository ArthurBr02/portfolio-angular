<div class="admin-page">
    <app-admin-page-header [title]="'admin.skillsPage.manageSkills' | translate" [buttonText]="'admin.skillsPage.addNewCategory' | translate" [showForm]="showForm()"
        (buttonClick)="toggleForm()">
    </app-admin-page-header>

    @if (showForm()) {
    <div class="form-card glass-card">
        <h3>{{ isEditMode() ? ('admin.skillsPage.editSkillCategory' | translate) : ('admin.skillsPage.addNewSkillCategory' | translate) }}</h3>
        <form [formGroup]="skillForm" (ngSubmit)="onSubmit()">
            <app-form-input [label]="'admin.skillsPage.categoryName' | translate" formControlName="name" [required]="true"
                [placeholder]="'admin.placeholders.categoryName' | translate">
            </app-form-input>

            <app-form-file-input [label]="'admin.skillsPage.iconImage' | translate" accept="image/*" [required]="!isEditMode()"
                (fileSelected)="onIconFileSelected($event)">
            </app-form-file-input>
            @if (selectedIconFile) {
            <small class="form-hint" style="color: #10b981; display: block; margin-top: -1rem; margin-bottom: 1rem;">
                {{ 'admin.skillsPage.selectedFile' | translate }} {{ selectedIconFile.name }}
            </small>
            }
            @if (isEditMode() && !selectedIconFile) {
            <small class="form-hint" style="color: #a1a1aa; display: block; margin-top: -1rem; margin-bottom: 1rem;">
                {{ 'admin.skillsPage.keepCurrentIcon' | translate }}
            </small>
            }

            <app-form-input [label]="'admin.skillsPage.skills' | translate" formControlName="skills" [required]="true"
                [placeholder]="'admin.placeholders.skillsList' | translate">
            </app-form-input>

            <div style="display: flex; gap: 1rem;">
                <button type="submit" class="btn btn-primary" [disabled]="skillForm.invalid || isSubmitting()">
                    {{ isSubmitting() ? ('admin.skillsPage.savingCategory' | translate) : (isEditMode() ? ('admin.skillsPage.updateCategory' | translate) : ('admin.skillsPage.saveCategory' | translate)) }}
                </button>
                @if (isEditMode()) {
                <button type="button" class="btn btn-secondary" (click)="cancelEdit()">
                    {{ 'admin.skillsPage.cancel' | translate }}
                </button>
                }
            </div>
        </form>
    </div>
    }

    <div class="skills-list">
        @for (category of skillCategories(); track category.name) {
        <div class="skill-item glass-card">
            <div class="skill-icon">
                <img [src]="getIconUrl(category.id)" [alt]="category.name + ' icon'">
            </div>
            <div class="skill-info">
                <h4>{{ category.name }}</h4>
                <div class="tech-tags">
                    @for (skill of getEditableSkills(category.id); track skill.name) {
                    <div class="skill-card-compact">
                        <span class="skill-name-label">{{ skill.name }}</span>
                        <div class="autonomy-selector">
                            @for (lvl of autonomyScale; track lvl) {
                            <button type="button" 
                                class="autonomy-dot" 
                                [class.active]="(skill.autonomyLevel ?? 0) >= lvl"
                                (click)="updateSkillAutonomy(category.id, skill.name, lvl)"
                                [title]="'skills.autonomy.level' + lvl | translate">
                            </button>
                            }
                            <button type="button" class="autonomy-clear" 
                                (click)="updateSkillAutonomy(category.id, skill.name, '')"
                                title="{{ 'admin.skillsPage.autonomyNone' | translate }}">
                                ‚úï
                            </button>
                        </div>
                    </div>
                    }
                </div>
            </div>
            <div class="skill-actions">
                <button type="button" class="btn-edit" (click)="editCategory(category)" title="{{ 'admin.skillsPage.editCategory' | translate }}">‚úèÔ∏è</button>
                <button type="button" class="btn-delete" (click)="deleteCategory(category.id, $event)" title="{{ 'admin.skillsPage.deleteCategory' | translate }}">üóëÔ∏è</button>
            </div>
        </div>
        }
    </div>

    <app-delete-confirmation-modal [isOpen]="showDeleteModal()" [title]="'admin.skillsPage.deleteCategory' | translate"
        [message]="'admin.skillsPage.confirmDelete' | translate"
        (confirm)="confirmDelete()" (cancel)="closeDeleteModal()">
    </app-delete-confirmation-modal>
</div>